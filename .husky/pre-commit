#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

if [ "$HUSKY_GIT_PARAMS" = "--no-verify" ]; then
  echo "‚úÖ –•—É–∫ –ø—Ä–æ–ø—É—â–µ–Ω (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω --no-verify)"
  exit 0
fi

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –≤–µ—Ç–∫–∞ —Å "feature/"
if echo "$CURRENT_BRANCH" | grep -q '^feature/'; then
  echo "üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º npx changeset –¥–ª—è –≤–µ—Ç–∫–∏ $CURRENT_BRANCH"
  npx changeset

  # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2 —Å–µ–∫—É–Ω–¥—ã)
  echo "‚è≥ –û–∂–∏–¥–∞–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ —Ñ–∞–π–ª–∞..."
while [ ! -f .changeset/*.md ]; do
  sleep 1
done

  git add .changeset/*.md
  echo "‚úÖ changeset —Å–æ–∑–¥–∞–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–º–º–∏—Ç"
else
  echo "‚ÑπÔ∏è –í–µ—Ç–∫–∞ $CURRENT_BRANCH –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç pattern 'feature/*' ‚Äî changeset –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è"
fi